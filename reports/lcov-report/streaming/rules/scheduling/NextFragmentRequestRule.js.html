<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for streaming\rules\scheduling\NextFragmentRequestRule.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">all files</a> / <a href="index.html">streaming/rules/scheduling/</a> NextFragmentRequestRule.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">25% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>12/48</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">16% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>4/25</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">33.33% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>1/3</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">23.4% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>11/47</span>
      </div>
      <div class='fl pad1y'>
        <span class="strong">1 branch</span>
        <span class="quiet">Ignored</span>  &nbsp;&nbsp;&nbsp;&nbsp;
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * The copyright in this software is being made available under the BSD License,
 * included below. This software may be subject to other third party and contributor
 * rights, including patent rights, and no such rights are granted under this license.
 *
 * Copyright (c) 2013, Dash Industry Forum.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *  * Redistributions of source code must retain the above copyright notice, this
 *  list of conditions and the following disclaimer.
 *  * Redistributions in binary form must reproduce the above copyright notice,
 *  this list of conditions and the following disclaimer in the documentation and/or
 *  other materials provided with the distribution.
 *  * Neither the name of Dash Industry Forum nor the names of its
 *  contributors may be used to endorse or promote products derived from this software
 *  without specific prior written permission.
 *
 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY
 *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 *  POSSIBILITY OF SUCH DAMAGE.
 */
'use strict';
&nbsp;
Object.defineProperty(exports, '__esModule', {
    value: true
});
// istanbul ignore next
&nbsp;
function _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? <span class="branch-0 cbranch-skip" title="branch not covered" >obj </span>: { 'default': obj }; }
&nbsp;
var _coreDebug = require('../../../core/Debug');
&nbsp;
var _coreDebug2 = _interopRequireDefault(_coreDebug);
&nbsp;
var _coreFactoryMaker = require('../../../core/FactoryMaker');
&nbsp;
var _coreFactoryMaker2 = _interopRequireDefault(_coreFactoryMaker);
&nbsp;
<span class="fstat-no" title="function not covered" >function NextFragmentRequestRule(config) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    var context = this.context;</span>
<span class="cstat-no" title="statement not covered" >    var log = (0, _coreDebug2['default'])(context).getInstance().log;</span>
<span class="cstat-no" title="statement not covered" >    var adapter = config.adapter;</span>
<span class="cstat-no" title="statement not covered" >    var sourceBufferController = config.sourceBufferController;</span>
<span class="cstat-no" title="statement not covered" >    var textSourceBuffer = config.textSourceBuffer;</span>
&nbsp;
<span class="fstat-no" title="function not covered" >    function execute(streamProcessor, requestToReplace) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        var representationInfo = streamProcessor.getCurrentRepresentationInfo();</span>
<span class="cstat-no" title="statement not covered" >        var mediaInfo = representationInfo.mediaInfo;</span>
<span class="cstat-no" title="statement not covered" >        var mediaType = mediaInfo.type;</span>
<span class="cstat-no" title="statement not covered" >        var scheduleController = streamProcessor.getScheduleController();</span>
<span class="cstat-no" title="statement not covered" >        var seekTarget = scheduleController.getSeekTarget();</span>
<span class="cstat-no" title="statement not covered" >        var hasSeekTarget = !isNaN(seekTarget);</span>
<span class="cstat-no" title="statement not covered" >        var buffer = streamProcessor.getBuffer();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        var time = hasSeekTarget ? seekTarget : adapter.getIndexHandlerTime(streamProcessor);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (isNaN(time) || mediaType === 'fragmentedText' &amp;&amp; textSourceBuffer.getAllTracksAreDisabled()) {</span>
<span class="cstat-no" title="statement not covered" >            return null;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (hasSeekTarget) {</span>
<span class="cstat-no" title="statement not covered" >            scheduleController.setSeekTarget(NaN);</span>
        }
&nbsp;
        /**
         * This is critical for IE/Safari/EDGE
         * */
<span class="cstat-no" title="statement not covered" >        if (buffer) {</span>
<span class="cstat-no" title="statement not covered" >            var range = sourceBufferController.getBufferRange(streamProcessor.getBuffer(), time);</span>
<span class="cstat-no" title="statement not covered" >            if (range !== null) {</span>
<span class="cstat-no" title="statement not covered" >                log('Prior to making a request for time, NextFragmentRequestRule is aligning index handler\'s currentTime with bufferedRange.end.', time, ' was changed to ', range.end);</span>
<span class="cstat-no" title="statement not covered" >                time = range.end;</span>
            }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        var request = undefined;</span>
<span class="cstat-no" title="statement not covered" >        if (requestToReplace) {</span>
<span class="cstat-no" title="statement not covered" >            time = requestToReplace.startTime + requestToReplace.duration / 2;</span>
<span class="cstat-no" title="statement not covered" >            request = adapter.getFragmentRequestForTime(streamProcessor, representationInfo, time, { timeThreshold: 0, ignoreIsFinished: true });</span>
        } else {
<span class="cstat-no" title="statement not covered" >            request = adapter.getFragmentRequestForTime(streamProcessor, representationInfo, time, { keepIdx: !hasSeekTarget });</span>
<span class="cstat-no" title="statement not covered" >            if (request &amp;&amp; streamProcessor.getFragmentModel().isFragmentLoaded(request)) {</span>
<span class="cstat-no" title="statement not covered" >                request = adapter.getNextFragmentRequest(streamProcessor, representationInfo);</span>
            }
<span class="cstat-no" title="statement not covered" >            if (request) {</span>
<span class="cstat-no" title="statement not covered" >                adapter.setIndexHandlerTime(streamProcessor, request.startTime + request.duration);</span>
<span class="cstat-no" title="statement not covered" >                request.delayLoadingTime = new Date().getTime() + scheduleController.getTimeToLoadDelay();</span>
<span class="cstat-no" title="statement not covered" >                scheduleController.setTimeToLoadDelay(0);</span>
            }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return request;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    var instance = {</span>
        execute: execute
    };
&nbsp;
<span class="cstat-no" title="statement not covered" >    return instance;</span>
}
&nbsp;
NextFragmentRequestRule.__dashjs_factory_name = 'NextFragmentRequestRule';
exports['default'] = _coreFactoryMaker2['default'].getClassFactory(NextFragmentRequestRule);
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6L0FwYWNoZTI0L2h0ZG9jcy9NeURhc2gvc3JjL3N0cmVhbWluZy9ydWxlcy9zY2hlZHVsaW5nL05leHRGcmFnbWVudFJlcXVlc3RSdWxlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozt5QkE4QmtCLHFCQUFxQjs7OztnQ0FDZCw0QkFBNEI7Ozs7QUFFckQsU0FBUyx1QkFBdUIsQ0FBQyxNQUFNLEVBQUU7O0FBRXJDLFFBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7QUFDN0IsUUFBTSxHQUFHLEdBQUcsNEJBQU0sT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsR0FBRyxDQUFDO0FBQzdDLFFBQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUM7QUFDL0IsUUFBTSxzQkFBc0IsR0FBRyxNQUFNLENBQUMsc0JBQXNCLENBQUM7QUFDN0QsUUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsZ0JBQWdCLENBQUM7O0FBRWpELGFBQVMsT0FBTyxDQUFDLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRTs7QUFFaEQsWUFBTSxrQkFBa0IsR0FBRyxlQUFlLENBQUMsNEJBQTRCLEVBQUUsQ0FBQztBQUMxRSxZQUFNLFNBQVMsR0FBRyxrQkFBa0IsQ0FBQyxTQUFTLENBQUM7QUFDL0MsWUFBTSxTQUFTLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQztBQUNqQyxZQUFNLGtCQUFrQixHQUFHLGVBQWUsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0FBQ25FLFlBQU0sVUFBVSxHQUFHLGtCQUFrQixDQUFDLGFBQWEsRUFBRSxDQUFDO0FBQ3RELFlBQU0sYUFBYSxHQUFHLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3pDLFlBQU0sTUFBTSxHQUFHLGVBQWUsQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7QUFFM0MsWUFBSSxJQUFJLEdBQUcsYUFBYSxHQUFHLFVBQVUsR0FBRyxPQUFPLENBQUMsbUJBQW1CLENBQUMsZUFBZSxDQUFDLENBQUM7O0FBRXJGLFlBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFLLFNBQVMsS0FBSyxnQkFBZ0IsSUFBSSxnQkFBZ0IsQ0FBQyx1QkFBdUIsRUFBRSxBQUFDLEVBQUU7QUFDL0YsbUJBQU8sSUFBSSxDQUFDO1NBQ2Y7O0FBRUQsWUFBSSxhQUFhLEVBQUU7QUFDZiw4QkFBa0IsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDekM7Ozs7O0FBS0QsWUFBSSxNQUFNLEVBQUU7QUFDUixnQkFBTSxLQUFLLEdBQUcsc0JBQXNCLENBQUMsY0FBYyxDQUFDLGVBQWUsQ0FBQyxTQUFTLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztBQUN2RixnQkFBSSxLQUFLLEtBQUssSUFBSSxFQUFFO0FBQ2hCLG1CQUFHLENBQUMsOEhBQThILEVBQUUsSUFBSSxFQUFFLGtCQUFrQixFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN6SyxvQkFBSSxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUM7YUFDcEI7U0FDSjs7QUFFRCxZQUFJLE9BQU8sWUFBQSxDQUFDO0FBQ1osWUFBSSxnQkFBZ0IsRUFBRTtBQUNsQixnQkFBSSxHQUFHLGdCQUFnQixDQUFDLFNBQVMsR0FBSSxnQkFBZ0IsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxBQUFDLENBQUM7QUFDcEUsbUJBQU8sR0FBRyxPQUFPLENBQUMseUJBQXlCLENBQUMsZUFBZSxFQUFFLGtCQUFrQixFQUFFLElBQUksRUFBRSxFQUFDLGFBQWEsRUFBRSxDQUFDLEVBQUUsZ0JBQWdCLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztTQUN0SSxNQUFNO0FBQ0gsbUJBQU8sR0FBRyxPQUFPLENBQUMseUJBQXlCLENBQUMsZUFBZSxFQUFFLGtCQUFrQixFQUFFLElBQUksRUFBRSxFQUFDLE9BQU8sRUFBRSxDQUFDLGFBQWEsRUFBQyxDQUFDLENBQUM7QUFDbEgsZ0JBQUksT0FBTyxJQUFJLGVBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxFQUFFO0FBQ3pFLHVCQUFPLEdBQUcsT0FBTyxDQUFDLHNCQUFzQixDQUFDLGVBQWUsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO2FBQ2pGO0FBQ0QsZ0JBQUksT0FBTyxFQUFFO0FBQ1QsdUJBQU8sQ0FBQyxtQkFBbUIsQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDbkYsdUJBQU8sQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxHQUFHLGtCQUFrQixDQUFDLGtCQUFrQixFQUFFLENBQUM7QUFDMUYsa0NBQWtCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDNUM7U0FDSjs7QUFFRCxlQUFPLE9BQU8sQ0FBQztLQUNsQjs7QUFFRCxRQUFNLFFBQVEsR0FBRztBQUNiLGVBQU8sRUFBRSxPQUFPO0tBQ25CLENBQUM7O0FBRUYsV0FBTyxRQUFRLENBQUM7Q0FDbkI7O0FBRUQsdUJBQXVCLENBQUMscUJBQXFCLEdBQUcseUJBQXlCLENBQUM7cUJBQzNELDhCQUFhLGVBQWUsQ0FBQyx1QkFBdUIsQ0FBQyIsImZpbGUiOiJDOi9BcGFjaGUyNC9odGRvY3MvTXlEYXNoL3NyYy9zdHJlYW1pbmcvcnVsZXMvc2NoZWR1bGluZy9OZXh0RnJhZ21lbnRSZXF1ZXN0UnVsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGhlIGNvcHlyaWdodCBpbiB0aGlzIHNvZnR3YXJlIGlzIGJlaW5nIG1hZGUgYXZhaWxhYmxlIHVuZGVyIHRoZSBCU0QgTGljZW5zZSxcbiAqIGluY2x1ZGVkIGJlbG93LiBUaGlzIHNvZnR3YXJlIG1heSBiZSBzdWJqZWN0IHRvIG90aGVyIHRoaXJkIHBhcnR5IGFuZCBjb250cmlidXRvclxuICogcmlnaHRzLCBpbmNsdWRpbmcgcGF0ZW50IHJpZ2h0cywgYW5kIG5vIHN1Y2ggcmlnaHRzIGFyZSBncmFudGVkIHVuZGVyIHRoaXMgbGljZW5zZS5cbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTMsIERhc2ggSW5kdXN0cnkgRm9ydW0uXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sXG4gKiBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG4gKiAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXNcbiAqICBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSxcbiAqICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uIGFuZC9vclxuICogIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKiAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIERhc2ggSW5kdXN0cnkgRm9ydW0gbm9yIHRoZSBuYW1lcyBvZiBpdHNcbiAqICBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlXG4gKiAgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG4gKlxuICogIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgQVMgSVMgQU5EIEFOWVxuICogIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRURcbiAqICBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuXG4gKiAgSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCxcbiAqICBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUXG4gKiAgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUlxuICogIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLFxuICogIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSlcbiAqICBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRVxuICogIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICovXG5pbXBvcnQgRGVidWcgZnJvbSAnLi4vLi4vLi4vY29yZS9EZWJ1Zyc7XG5pbXBvcnQgRmFjdG9yeU1ha2VyIGZyb20gJy4uLy4uLy4uL2NvcmUvRmFjdG9yeU1ha2VyJztcblxuZnVuY3Rpb24gTmV4dEZyYWdtZW50UmVxdWVzdFJ1bGUoY29uZmlnKSB7XG5cbiAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5jb250ZXh0O1xuICAgIGNvbnN0IGxvZyA9IERlYnVnKGNvbnRleHQpLmdldEluc3RhbmNlKCkubG9nO1xuICAgIGNvbnN0IGFkYXB0ZXIgPSBjb25maWcuYWRhcHRlcjtcbiAgICBjb25zdCBzb3VyY2VCdWZmZXJDb250cm9sbGVyID0gY29uZmlnLnNvdXJjZUJ1ZmZlckNvbnRyb2xsZXI7XG4gICAgY29uc3QgdGV4dFNvdXJjZUJ1ZmZlciA9IGNvbmZpZy50ZXh0U291cmNlQnVmZmVyO1xuXG4gICAgZnVuY3Rpb24gZXhlY3V0ZShzdHJlYW1Qcm9jZXNzb3IsIHJlcXVlc3RUb1JlcGxhY2UpIHtcblxuICAgICAgICBjb25zdCByZXByZXNlbnRhdGlvbkluZm8gPSBzdHJlYW1Qcm9jZXNzb3IuZ2V0Q3VycmVudFJlcHJlc2VudGF0aW9uSW5mbygpO1xuICAgICAgICBjb25zdCBtZWRpYUluZm8gPSByZXByZXNlbnRhdGlvbkluZm8ubWVkaWFJbmZvO1xuICAgICAgICBjb25zdCBtZWRpYVR5cGUgPSBtZWRpYUluZm8udHlwZTtcbiAgICAgICAgY29uc3Qgc2NoZWR1bGVDb250cm9sbGVyID0gc3RyZWFtUHJvY2Vzc29yLmdldFNjaGVkdWxlQ29udHJvbGxlcigpO1xuICAgICAgICBjb25zdCBzZWVrVGFyZ2V0ID0gc2NoZWR1bGVDb250cm9sbGVyLmdldFNlZWtUYXJnZXQoKTtcbiAgICAgICAgY29uc3QgaGFzU2Vla1RhcmdldCA9ICFpc05hTihzZWVrVGFyZ2V0KTtcbiAgICAgICAgY29uc3QgYnVmZmVyID0gc3RyZWFtUHJvY2Vzc29yLmdldEJ1ZmZlcigpO1xuXG4gICAgICAgIGxldCB0aW1lID0gaGFzU2Vla1RhcmdldCA/IHNlZWtUYXJnZXQgOiBhZGFwdGVyLmdldEluZGV4SGFuZGxlclRpbWUoc3RyZWFtUHJvY2Vzc29yKTtcblxuICAgICAgICBpZiAoaXNOYU4odGltZSkgfHwgKG1lZGlhVHlwZSA9PT0gJ2ZyYWdtZW50ZWRUZXh0JyAmJiB0ZXh0U291cmNlQnVmZmVyLmdldEFsbFRyYWNrc0FyZURpc2FibGVkKCkpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChoYXNTZWVrVGFyZ2V0KSB7XG4gICAgICAgICAgICBzY2hlZHVsZUNvbnRyb2xsZXIuc2V0U2Vla1RhcmdldChOYU4pO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgaXMgY3JpdGljYWwgZm9yIElFL1NhZmFyaS9FREdFXG4gICAgICAgICAqICovXG4gICAgICAgIGlmIChidWZmZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IHJhbmdlID0gc291cmNlQnVmZmVyQ29udHJvbGxlci5nZXRCdWZmZXJSYW5nZShzdHJlYW1Qcm9jZXNzb3IuZ2V0QnVmZmVyKCksIHRpbWUpO1xuICAgICAgICAgICAgaWYgKHJhbmdlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgbG9nKCdQcmlvciB0byBtYWtpbmcgYSByZXF1ZXN0IGZvciB0aW1lLCBOZXh0RnJhZ21lbnRSZXF1ZXN0UnVsZSBpcyBhbGlnbmluZyBpbmRleCBoYW5kbGVyXFwncyBjdXJyZW50VGltZSB3aXRoIGJ1ZmZlcmVkUmFuZ2UuZW5kLicsIHRpbWUsICcgd2FzIGNoYW5nZWQgdG8gJywgcmFuZ2UuZW5kKTtcbiAgICAgICAgICAgICAgICB0aW1lID0gcmFuZ2UuZW5kO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJlcXVlc3Q7XG4gICAgICAgIGlmIChyZXF1ZXN0VG9SZXBsYWNlKSB7XG4gICAgICAgICAgICB0aW1lID0gcmVxdWVzdFRvUmVwbGFjZS5zdGFydFRpbWUgKyAocmVxdWVzdFRvUmVwbGFjZS5kdXJhdGlvbiAvIDIpO1xuICAgICAgICAgICAgcmVxdWVzdCA9IGFkYXB0ZXIuZ2V0RnJhZ21lbnRSZXF1ZXN0Rm9yVGltZShzdHJlYW1Qcm9jZXNzb3IsIHJlcHJlc2VudGF0aW9uSW5mbywgdGltZSwge3RpbWVUaHJlc2hvbGQ6IDAsIGlnbm9yZUlzRmluaXNoZWQ6IHRydWV9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcXVlc3QgPSBhZGFwdGVyLmdldEZyYWdtZW50UmVxdWVzdEZvclRpbWUoc3RyZWFtUHJvY2Vzc29yLCByZXByZXNlbnRhdGlvbkluZm8sIHRpbWUsIHtrZWVwSWR4OiAhaGFzU2Vla1RhcmdldH0pO1xuICAgICAgICAgICAgaWYgKHJlcXVlc3QgJiYgc3RyZWFtUHJvY2Vzc29yLmdldEZyYWdtZW50TW9kZWwoKS5pc0ZyYWdtZW50TG9hZGVkKHJlcXVlc3QpKSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IGFkYXB0ZXIuZ2V0TmV4dEZyYWdtZW50UmVxdWVzdChzdHJlYW1Qcm9jZXNzb3IsIHJlcHJlc2VudGF0aW9uSW5mbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVxdWVzdCkge1xuICAgICAgICAgICAgICAgIGFkYXB0ZXIuc2V0SW5kZXhIYW5kbGVyVGltZShzdHJlYW1Qcm9jZXNzb3IsIHJlcXVlc3Quc3RhcnRUaW1lICsgcmVxdWVzdC5kdXJhdGlvbik7XG4gICAgICAgICAgICAgICAgcmVxdWVzdC5kZWxheUxvYWRpbmdUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyBzY2hlZHVsZUNvbnRyb2xsZXIuZ2V0VGltZVRvTG9hZERlbGF5KCk7XG4gICAgICAgICAgICAgICAgc2NoZWR1bGVDb250cm9sbGVyLnNldFRpbWVUb0xvYWREZWxheSgwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXF1ZXN0O1xuICAgIH1cblxuICAgIGNvbnN0IGluc3RhbmNlID0ge1xuICAgICAgICBleGVjdXRlOiBleGVjdXRlXG4gICAgfTtcblxuICAgIHJldHVybiBpbnN0YW5jZTtcbn1cblxuTmV4dEZyYWdtZW50UmVxdWVzdFJ1bGUuX19kYXNoanNfZmFjdG9yeV9uYW1lID0gJ05leHRGcmFnbWVudFJlcXVlc3RSdWxlJztcbmV4cG9ydCBkZWZhdWx0IEZhY3RvcnlNYWtlci5nZXRDbGFzc0ZhY3RvcnkoTmV4dEZyYWdtZW50UmVxdWVzdFJ1bGUpO1xuIl19</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Jan 15 2017 21:03:55 GMT+0800 (中国标准时间)
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
